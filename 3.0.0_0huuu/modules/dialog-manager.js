window.DialogManager=function(){"use strict";let a=null,e=!1;async function t(){if(e)return!0;try{return await UnifiedDatabaseManager.init(),a=UnifiedDatabaseManager.db,e=!0,!0}catch(a){throw a}}async function n(){try{return(await chrome.storage.local.get(["rememberDialog"])).rememberDialog||!1}catch(a){return!1}}async function r(a,e){try{if(!await n())return!1;await t();const r={id:a,workflowId:a,messages:e,updatedAt:(new Date).toISOString(),messageCount:e.length,type:"workflow-dialog"};return await UnifiedDatabaseManager.saveDialog(r),!0}catch(a){return!1}}async function i(a){try{if(!await n())return[];await t();const e=await UnifiedDatabaseManager.getById("dialogs",a);return e&&e.messages?e.messages:[]}catch(a){return[]}}return{init:t,isRememberDialogEnabled:n,saveDialog:r,loadDialog:i,deleteDialog:async function(a){try{return await t(),await UnifiedDatabaseManager.deleteDialog(a),!0}catch(a){return!1}},addMessage:async function(a,e,t){try{if(!await n())return!1;const s=await i(a),o={id:Date.now(),sender:e,message:t,timestamp:(new Date).toISOString()};return s.push(o),await r(a,s)}catch(a){return!1}},formatMessagesForAI:function(a){return Array.isArray(a)&&0!==a.length?a.map((a=>({role:"user"===a.sender?"user":"assistant",content:a.message}))):[]}}}();