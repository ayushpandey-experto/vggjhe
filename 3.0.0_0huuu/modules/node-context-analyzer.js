const NodeContextAnalyzer={debugLevel:"verbose",init:function(){},log:function(e,t,...n){"error"===e||"success"===e||("info"!==e||"detailed"!==this.debugLevel&&"verbose"!==this.debugLevel)&&"verbose"===e&&this.debugLevel},setDebugLevel:function(e){["minimal","detailed","verbose"].includes(e)&&(this.debugLevel=e)},debugNodePanel:function(){const e=this.findOpenNodePanel();if(!e)return;e.querySelectorAll('h1, h2, h3, .title, .heading, [class*="title"], [class*="heading"]').forEach(((e,t)=>{}));const t=e.querySelectorAll('[class*="parameter"], [class*="input"], [data-test-id*="parameter"]');Array.from(t).slice(0,5).forEach(((e,t)=>{}))},getCurrentNodeContext:function(){try{const e=this.findOpenNodePanel();if(!e)return{isOpen:!1,nodeName:null,nodeType:null,activeTab:null,parameters:{},availableOptions:[],fieldTypes:{},reason:"no_node_panel_found"};if(!this.hasNodeContentIndicators(e))return{isOpen:!1,nodeName:null,nodeType:null,activeTab:null,parameters:{},availableOptions:[],fieldTypes:{},reason:"invalid_node_panel"};const t={isOpen:!0,nodeName:this.getNodeName(e),nodeType:this.detectNodeType(e),activeTab:this.getActiveTab(e),parameters:{},availableOptions:[],fieldTypes:{}};return this.extractNodeParameters(e,t),this.extractAvailableOptions(e,t),this.enrichContext(t),t}catch(e){return{isOpen:!1,error:e.message,reason:"extraction_error"}}},findOpenNodePanel:function(){const e=['[data-test-id="ndv-modal"]:not([style*="display: none"])','.ndv-wrapper:not([style*="display: none"])','[data-test-id="ndv"]:not([style*="display: none"])'],t=['.ndv-container:not([style*="display: none"])','.node-settings-dialog:not([style*="display: none"])','[data-test-id="node-parameters"]:not([style*="display: none"])','.node-details-view:not([style*="display: none"])'];this.log("info","🔍 Trying to find open node panel..."),this.log("info","🔍 Step 1: Trying priority selectors...");for(const t of e){this.log("verbose","🔍 Trying priority selector:",t);const e=document.querySelector(t);if(e){if(this.log("verbose","🔍 Found element with priority selector:",t),this.isVisible(e)&&this.hasNodeContentIndicators(e))return this.log("success","✅ Found valid node panel with priority selector:",t),e;this.log("verbose","❌ Element found but not valid or visible:",t)}else this.log("verbose","❌ No element found for priority selector:",t)}this.log("info","🔍 Step 2: Trying fallback selectors...");for(const e of t){this.log("verbose","🔍 Trying fallback selector:",e);const t=document.querySelector(e);if(t){if(this.log("verbose","🔍 Found element with fallback selector:",e),this.isVisible(t)&&this.hasNodeContentIndicators(t))return this.log("success","✅ Found valid node panel with fallback selector:",e),t;this.log("verbose","❌ Element found but not valid or visible:",e)}else this.log("verbose","❌ No element found for fallback selector:",e)}return this.log("info","🔍 No aggressive fallback search - if priority/fallback selectors failed, no node is open"),this.log("error","❌ No open node panel found"),null},isVisible:function(e){if(!e)return!1;const t=window.getComputedStyle(e),n=e.getBoundingClientRect(),o="none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0;return this.log("verbose","🔍 Visibility check:",{element:e.className,display:t.display,visibility:t.visibility,opacity:t.opacity,width:n.width,height:n.height,isVisible:o}),o},hasNodeContentIndicators:function(e){if(!e)return!1;const t=e.textContent.toLowerCase(),n=(e.innerHTML.toLowerCase(),e.getAttribute("data-test-id")),o="ndv-modal"===n||"ndv"===n||"node-parameters"===n||e.classList.contains("ndv-wrapper")||e.classList.contains("ndv-container");if(!o)return this.log("verbose","❌ Not a valid NDV panel:",e.className,"data-test-id:",n),!1;const r=e.querySelector('.ndv-header, [data-test-id*="ndv-title"], .node-title, h1, h2, h3, .heading, .title'),i=e.querySelector('.ndv-content, .node-parameters, [data-test-id*="parameter"], [class*="parameter"]'),s=e.querySelector("input, textarea, select, .parameter-input, .cm-editor, button"),a=r||i||s,l=e.offsetWidth>200&&e.offsetHeight>100,c=!e.classList.contains("vue-flow__container")&&!e.classList.contains("vue-flow__nodes"),d=o&&a&&l&&c;return this.log("verbose","🔍 Strict node panel validation:",{element:e.className,dataTestId:e.getAttribute("data-test-id"),isNDV:o,hasNodeHeader:!!r,hasNodeContent:!!i,hasParameterInputs:!!s,hasValidContent:a,isLargeEnough:l,isNotWorkflowContainer:c,width:e.offsetWidth,height:e.offsetHeight,contentLength:t.length,isValidNodePanel:d}),d},getNodeName:function(e){const t=['[data-test-id="node-title"]',".node-title",".ndv-header .node-name",".node-header-title",".ndv-header h2",".ndv-header .heading",".ndv-title",".node-details-header h2",".node-details-header .title",'[data-test-id="ndv-title"]',"h1","h2","h3"];for(const n of t){const t=e.querySelector(n);if(t&&t.textContent.trim()){return t.textContent.trim()}}const n=e.textContent.toLowerCase();if(n.includes("ai agent")||n.includes("chat model")||n.includes("source for prompt")||n.includes("output format"))return"AI Agent";if(n.includes("http request")||n.includes("webhook")||n.includes("method")&&n.includes("url"))return"HTTP Request";if(n.includes("code")||n.includes("javascript")||n.includes("function"))return"Code";const o=window.location.href;if(o.includes("/workflow/")){const e=o.split("/"),t=e.indexOf("workflow");if(t>=0&&e[t+2])return"Node Panel"}return"Unknown Node"},detectNodeType:function(e){const t=this.getNodeName(e).toLowerCase(),n=e.textContent.toLowerCase();return t.includes("ai agent")||t.includes("openai")||t.includes("anthropic")||t.includes("claude")||t.includes("gpt")||n.includes("chat model")?"ai-agent":t.includes("http")||t.includes("webhook")||n.includes("http request")?"http-request":t.includes("code")||t.includes("function")||t.includes("javascript")?"code":t.includes("postgres")||t.includes("mysql")||t.includes("mongo")||t.includes("database")?"database":t.includes("email")||t.includes("gmail")||t.includes("smtp")||t.includes("imap")?"email":"generic"},getActiveTab:function(e){const t=e.querySelector(".el-tabs__item.is-active, .tab-item.active, .active-tab");return t&&t.textContent.trim()?t.textContent.trim():e.querySelector('[data-test-id*="parameter"]')?"Parameters":e.querySelector(".node-settings, .settings-panel")?"Settings":"Unknown Tab"},extractNodeParameters:function(e,t){if(this.log("info","🔍 Starting parameter extraction from panel:",e.className),this.log("verbose","🔍 Panel for extraction - class:",e.className),this.log("verbose","🔍 Panel for extraction - data-test-id:",e.getAttribute("data-test-id")),this.log("verbose","🔍 Panel for extraction - tag:",e.tagName),"code"===t.nodeType||t.nodeName.toLowerCase().includes("code"))return this.log("info","🔧 Detected CODE node - using specialized extraction"),void this.extractCodeNodeParameters(e,t);const n=['[data-test-id*="parameter-input"]',".parameter-input",".node-parameter-item",".parameter-item",".form-item",".el-form-item",".parameter-field",".ndv-parameter-item",".parameter-input-container",'[data-test-id*="parameter-container"]',".n8n-parameter-input",'[data-test-id*="parameter"]',".parameter-input-list-item",".n8n-parameter",".parameter-wrapper"],o=new Set,r=new Set;for(const i of n){const n=e.querySelectorAll(i);this.log("verbose",`🔍 Found ${n.length} fields with selector: ${i}`),n.forEach(((e,n)=>{if(o.has(e))return;o.add(e),this.log("verbose",`🔍 Processing field ${n}:`,e.className);const i=this.extractFieldLabel(e),s=this.extractFieldValue(e),a=this.detectFieldType(e);if(this.log("verbose",`🔍 Extracted - Label: "${i}", Value: "${s}", Type: "${a}"`),i&&"Unknown Parameter"!==i){if(r.has(i))return void this.log("verbose",`🔍 Skipping duplicate parameter: ${i}`);r.add(i),t.parameters[i]=s,t.fieldTypes[i]=a,this.log("success",`✅ Added parameter: ${i} = ${s}`)}else this.log("verbose","❌ Skipped field due to unknown label")}))}0===Object.keys(t.parameters).length&&(this.log("info","🔍 No parameters found, trying form structure extraction..."),this.extractFromFormStructure(e,t)),0===Object.keys(t.parameters).length&&(this.log("info","🔍 Still no parameters, trying text pattern extraction..."),this.extractFromTextPatterns(e,t)),this.log("success","🔍 Final parameter extraction result:",t.parameters)},extractAvailableOptions:function(e,t){const n=['[data-test-id*="add-option"]',".add-option",".parameter-option-add",'button[class*="add"]'];for(const o of n){e.querySelectorAll(o).forEach((e=>{const n=e.textContent.trim();if(n.toLowerCase().includes("add")||n.toLowerCase().includes("option")){const n=this.findAssociatedDropdown(e);if(n){const e=this.extractDropdownOptions(n);t.availableOptions.push(...e)}else t.availableOptions.push("Custom Options Available")}}))}this.extractExistingOptions(e,t)},findAssociatedDropdown:function(e){const t=e.closest(".parameter-item, .form-item, .el-form-item");return t?t.querySelector(".el-select, .dropdown, select"):null},extractDropdownOptions:function(e){const t=[];return e.querySelectorAll("option, .el-select-dropdown__item, .dropdown-item").forEach((e=>{const n=e.textContent.trim();!n||n.includes("Select")||n.includes("Choose")||t.push(n)})),t},enrichContext:function(e){const t=e.nodeType;"ai-agent"===t?(e.nodeCategory="AI Processing",e.commonQuestions=["system prompt location","model selection","output format","intermediate steps","token limits"]):"http-request"===t?(e.nodeCategory="HTTP Communication",e.commonQuestions=["authentication setup","headers configuration","request body format","error handling","timeout settings"]):"code"===t?(e.nodeCategory="Code Execution",e.commonQuestions=["javascript syntax","available libraries","input data access","return format","error handling"]):"database"===t&&(e.nodeCategory="Database Operations",e.commonQuestions=["connection setup","query syntax","parameterized queries","transaction handling","connection pooling"]),e.detectedCapabilities=[],Object.keys(e.parameters).forEach((t=>{const n=t.toLowerCase();(n.includes("json")||n.includes("format"))&&e.detectedCapabilities.push("structured-output"),(n.includes("prompt")||n.includes("message"))&&e.detectedCapabilities.push("text-generation"),(n.includes("auth")||n.includes("key")||n.includes("token"))&&e.detectedCapabilities.push("authentication"),(n.includes("url")||n.includes("endpoint"))&&e.detectedCapabilities.push("external-api")})),e.detectedCapabilities=[...new Set(e.detectedCapabilities)]},extractExistingOptions:function(e,t){const n=e.textContent.toLowerCase();["return intermediate steps","max iterations","fallback","timeout","retry","headers","authentication","ssl","proxy"].forEach((e=>{if(n.includes(e)){const n=e.split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ");t.availableOptions.includes(n)||t.availableOptions.push(n)}}))},extractCodeNodeParameters:function(e,t){this.log("info","🔧 Starting specialized CODE node parameter extraction");const n=[".cm-editor",".monaco-editor",".code-editor",'[data-test-id*="code-editor"]','[data-test-id*="jsCode"]',".parameter-input-jsCode",'.parameter-input[data-test-id*="jsCode"]'];let o=!1,r=null;for(const i of n){const n=e.querySelectorAll(i);if(this.log("verbose",`🔍 Found ${n.length} editors with selector: ${i}`),n.forEach(((e,n)=>{if(o)return;this.log("verbose",`🔍 Processing code editor ${n}:`,e.className);const i=this.extractCodeFromEditor(e);i&&"[Code Editor - Content Not Accessible]"!==i&&i.length>10?(r=i,t.parameters["JavaScript Code"]=i,t.fieldTypes["JavaScript Code"]="code",o=!0,this.log("success",`✅ Extracted JavaScript code (${i.length} characters)`),this.log("verbose",`📝 Code preview: ${i.substring(0,200)}...`)):this.log("verbose",`❌ No valid code found in editor ${n}`)})),o)break}if(!o){this.log("info","🔍 Main code not found with selectors, trying field-by-field search...");e.querySelectorAll('[data-test-id*="parameter"], .parameter-input, .parameter-item, .form-item').forEach(((e,n)=>{if(o)return;const i=e.className,s=e.getAttribute("data-test-id")||"";if(i.includes("jsCode")||s.includes("jsCode")||i.includes("code")||s.includes("code")){this.log("verbose",`🔍 Found potential code field ${n}:`,i,s);const a=this.extractFieldValue(e);a&&a.length>10&&!a.includes("[Code Editor")&&(r=a,t.parameters["JavaScript Code"]=a,t.fieldTypes["JavaScript Code"]="code",o=!0,this.log("success",`✅ Extracted JavaScript code from field (${a.length} characters)`),this.log("verbose",`📝 Code preview: ${a.substring(0,200)}...`))}}))}const i=new Set;['[data-test-id*="parameter-input"]',".parameter-input",".node-parameter-item",".parameter-item"].forEach((n=>{e.querySelectorAll(n).forEach((e=>{const n=this.extractFieldLabel(e),s=this.extractFieldValue(e),a=this.detectFieldType(e);if(n&&"Unknown Parameter"!==n){const e=this.getStandardCodeParameter(n)||n;if(i.has(e))return void this.log("verbose",`🔍 Skipping duplicate CODE parameter: ${e}`);if("JavaScript Code"===e&&o)return;if("JavaScript Code"===e&&r)return void this.log("verbose","🔍 Skipping code field - already have extracted code");i.add(e),t.parameters[e]=s,t.fieldTypes[e]=a,this.log("success",`✅ Added CODE parameter: ${e} = ${s}`)}}))}));if(e.querySelectorAll('select, .el-select, [data-test-id*="select"]').forEach((e=>{const n=this.extractSelectValue(e),o=e.closest(".parameter-item, .form-item, .el-form-item");if(o&&n){const e=this.extractFieldLabel(o);if(e&&"Unknown Parameter"!==e){const o=this.getStandardCodeParameter(e)||e;t.parameters[o]||(t.parameters[o]=n,t.fieldTypes[o]="select",this.log("success",`✅ Added CODE select parameter: ${o} = ${n}`))}}})),!o){this.log("info","🔍 Last resort: aggressive search for any code content...");e.querySelectorAll('textarea, .cm-content, .code-input, [class*="code"], [data-test-id*="code"]').forEach((e=>{if(o)return;const n=e.value||e.textContent||e.innerText;if(n&&n.trim()&&n.length>20){(n.includes("function")||n.includes("const")||n.includes("let")||n.includes("var")||n.includes("return")||n.includes("$input")||n.includes("{")||n.includes("}"))&&(t.parameters["JavaScript Code"]=n.trim(),t.fieldTypes["JavaScript Code"]="code",o=!0,this.log("success",`✅ Found code in aggressive search: ${n.substring(0,100)}...`))}}))}t.parameters["JavaScript Code"]||(t.parameters["JavaScript Code"]=r||"[Code Editor - Content Not Accessible]",t.fieldTypes["JavaScript Code"]="code"),this.log("success",`🔧 CODE node extraction completed. Found ${Object.keys(t.parameters).length} parameters`),this.log("info","📋 Final JavaScript Code status: "+(t.parameters["JavaScript Code"]?"EXTRACTED":"NOT FOUND"))},extractCodeFromEditor:function(e){if(this.log("verbose","🔍 Extracting code from editor:",e.className),e.classList.contains("cm-editor")||e.querySelector(".cm-content"))return this.extractFromCodeMirror(e);if(e.classList.contains("monaco-editor")||e.querySelector(".monaco-editor"))return this.extractFromMonaco(e);const t=e.textContent||e.innerText;return t&&t.trim()?t.trim():"[Code Editor - Content Not Accessible]"},extractFromCodeMirror:function(e){const t=[()=>e.CodeMirror?e.CodeMirror.getValue():null,()=>{const t=e.querySelector(".cm-content");return t?t.textContent||t.innerText:null},()=>{const t=e.querySelectorAll(".cm-line");return t.length>0?Array.from(t).map((e=>e.textContent||e.innerText||"")).join("\n"):null},()=>{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];let o;for(;o=t.nextNode();)o.textContent&&o.textContent.trim()&&n.push(o.textContent.trim());return n.length>0?n.join("\n"):null}];for(const e of t)try{const t=e();if(t&&t.trim())return this.log("success","✅ CodeMirror extraction successful"),t.trim()}catch(e){this.log("verbose","❌ CodeMirror strategy failed:",e.message)}return"[CodeMirror Editor - Content Not Accessible]"},extractFromMonaco:function(e){try{return window.monaco&&e.monaco?e.monaco.getValue():e.textContent||e.innerText||"[Monaco Editor - Content Not Accessible]"}catch(e){return"[Monaco Editor - Content Not Accessible]"}},extractSelectValue:function(e){if("SELECT"===e.tagName){const t=e.options[e.selectedIndex];return t?t.textContent||t.value:null}const t=e.querySelector(".el-select-dropdown__item.selected, .el-select__tags-text");if(t)return t.textContent?.trim();const n=e.querySelector(".n8n-select-option.selected, .selected");return n?n.textContent?.trim():null},getStandardCodeParameter:function(e){return{mode:"Mode","run once for all items":"Mode",language:"Language",javascript:"JavaScript Code",code:"JavaScript Code","always output data":"Always Output Data","execute once":"Execute Once","continue on fail":"Continue On Fail","retry on fail":"Retry On Fail","on error":"On Error","stop workflow":"On Error",notes:"Notes","display note in flow?":"Display Note in Flow"}[e.toLowerCase()]||null},extractFieldLabel:function(e){const t=[".parameter-input-label",".parameter-label",".node-parameter-label",".form-label",".el-form-item__label",".parameter-input-list-item-label",".n8n-parameter-label",".parameter-name",".field-label","label",'[data-test-id*="parameter-label"]',".parameter-title",".parameter-heading","h3","h4","h5",".parameter-description strong",".parameter-info strong"];for(const n of t){const t=e.querySelector(n)||e.closest(".parameter-item, .form-item, .el-form-item")?.querySelector(n);if(t&&t.textContent.trim()){return t.textContent.trim().replace(":","")}}const n=e.closest(".parameter-item, .form-item, .el-form-item");if(n){const e=n.querySelector('label, .label, span[class*="label"]');if(e&&e.textContent.trim())return e.textContent.trim().replace(":","")}const o=e.querySelector("input, textarea, select");if(o){const e=o.getAttribute("placeholder"),t=o.getAttribute("data-test-id");if(e&&!e.includes("example")&&!e.includes("Enter"))return e;if(t&&t.includes("parameter-input-"))return t.replace("parameter-input-","").replace("-"," ").replace(/^\w/,(e=>e.toUpperCase()))}return"Unknown Parameter"},extractFieldValue:function(e){this.log("verbose","🔍 Extracting value from field:",e.className,e.getAttribute("data-test-id"));const t=e.querySelector('.cm-editor, .cm-content, [data-test-id="inline-expression-editor-input"], .cm-focused, .cm-scroller');if(t){this.log("verbose","🔍 Found CodeMirror editor:",t.className);try{const e=t.closest(".cm-editor");if(e&&e.CodeMirror){const t=e.CodeMirror.getValue();if(t&&t.trim())return this.log("success","✅ CodeMirror instance value extracted:",t.substring(0,100)+"..."),t.trim()}}catch(e){this.log("verbose","❌ CodeMirror instance access failed:",e.message)}const e=t.querySelector(".cm-content");if(e){const t=e.textContent||e.innerText;if(this.log("verbose","🔍 CodeMirror content text:",t?t.substring(0,100)+"...":"empty"),t&&t.trim()&&t.length>10)return this.log("success","✅ CodeMirror content extracted successfully"),t.trim()}const n=t.querySelectorAll(".cm-line");if(n.length>0){const e=Array.from(n).map((e=>e.textContent||e.innerText||"")).join("\n");if(this.log("verbose","🔍 CodeMirror lines text:",e?e.substring(0,100)+"...":"empty"),e&&e.trim()&&e.length>10)return this.log("success","✅ CodeMirror lines extracted successfully"),e.trim()}const o=[],r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let i;for(;i=r.nextNode();)i.textContent&&i.textContent.trim()&&o.push(i.textContent.trim());if(o.length>0){const e=o.join("\n").trim();if(e&&e.length>10)return this.log("success","✅ CodeMirror text nodes extracted:",e.substring(0,100)+"..."),e}const s=t.textContent||t.innerText;return s&&s.trim()&&s.length>10?(this.log("success","✅ CodeMirror direct text extracted:",s.substring(0,100)+"..."),s.trim()):(this.log("verbose","❌ CodeMirror content not accessible through all strategies"),null)}const n=e.querySelector('input[type="text"], input[type="url"], input[type="email"], textarea, .el-input__inner, .n8n-input input');if(n){const e=n.value||n.textContent||n.getAttribute("placeholder")||"";if(this.log("verbose","🔍 Text input value:",e),e&&e.trim())return e.trim()}const o=e.querySelector('.n8n-input input, .parameter-input input, [data-test-id*="parameter-input"] input');if(o&&"checkbox"!==o.type){const e=o.value||o.getAttribute("placeholder")||"";if(this.log("verbose","🔍 N8N input value:",e),e&&e.trim())return e.trim()}const r=['input[type="checkbox"]',".el-switch__input",".n8n-switch input",".el-switch input",".toggle-switch input",'.parameter-input input[type="checkbox"]'];let i=!1,s=!1;for(const t of r){const n=e.querySelector(t);if(n){s=n.checked;const e=n.getAttribute("aria-checked");null!==e&&(s="true"===e);const o=n.getAttribute("true-value"),r=n.getAttribute("false-value"),a=n.value;o&&r&&(s=a===o),i=!0,this.log("verbose",`🔍 Toggle found (${t}): checked=${n.checked}, aria-checked=${e}, value=${a}, result=${s}`);break}}if(!i){const t=e.querySelector(".el-switch, .n8n-switch, .toggle-switch");if(t){const e=t.classList.contains("is-checked")||t.classList.contains("is-active")||t.classList.contains("active")||t.classList.contains("on"),n=t.querySelector("input");if(n){const e=n.getAttribute("aria-checked");s=null!==e?"true"===e:n.checked}else s=e;const o=t.querySelector(".el-switch__core, .switch-core, .toggle-core");if(o&&!s){const e=o.className;s=e.includes("is-checked")||e.includes("active")||e.includes("on")}i=!0,this.log("verbose","🔍 Toggle container found - state:",s,"active class:",e)}}if(i){const e=s?"enabled":"disabled";return this.log("verbose",`🔍 Final toggle state: ${e} (boolean: ${s})`),e}const a=e.querySelector('input[type="radio"]:checked');if(a){const e=a.value;return this.log("verbose","🔍 Radio value:",e),e}const l=e.querySelector("select");if(l){const e=l.options[l.selectedIndex]?.textContent||l.value;return this.log("verbose","🔍 Select value:",e),e}const c=e.querySelector(".el-select__tags-text, .el-select-dropdown__item.selected, .el-select .el-input__inner");if(c){const e=c.textContent?.trim()||c.value;if(this.log("verbose","🔍 Element UI select value:",e),e)return e}const d=e.querySelector('input[type="number"]');if(d){const e=d.value;return this.log("verbose","🔍 Number input value:",e),e}const u=e.textContent?.trim();if(u&&u.length>0&&u.length<200&&!(u.toLowerCase().includes("parameter")||u.toLowerCase().includes("setting")||u.toLowerCase().includes("option")||u.toLowerCase().includes("configure"))){const t=this.detectFieldType(e),n=this.extractFieldLabel(e),o=["always output","execute once","retry on fail","display note","enabled","disabled","on","off","true","false","continue on fail","ignore ssl","follow redirect","return intermediate","output data"],r=n?.toLowerCase()||"",i=u.toLowerCase();return"boolean"===t||o.some((e=>r.includes(e)||i.includes(e)))?(this.log("verbose","🔍 Boolean field detected, defaulting to false:",n),!1):(this.log("verbose","🔍 Field fallback text:",u),u)}return this.log("verbose","❌ No value found for field"),null},detectFieldType:function(e){const t=e.querySelector("input, textarea, select");if(!t)return"unknown";const n=t.type||t.tagName.toLowerCase(),o=t.getAttribute("placeholder")||"",r=t.getAttribute("name")||"";return"checkbox"===n?"boolean":"number"===n?"number":"email"===n?"email":"url"===n?"url":"password"===n?"password":"textarea"===n?"multiline-text":"select"===n?"dropdown":o.toLowerCase().includes("json")||r.includes("json")?"json":o.toLowerCase().includes("code")||r.includes("code")?"code":o.toLowerCase().includes("expression")?"expression":"text"},isParameterText:function(e){const t=e.toLowerCase();return!![/^[A-Z][a-zA-Z\s]+(\([^)]+\))?$/,/^[A-Z][a-zA-Z\s]+:$/,/^[a-z][a-zA-Z\s]+$/].some((t=>t.test(e)))||!!["prompt","message","source","format","output","input","model","temperature","max tokens","timeout","retry","url","method","headers","body","auth","key","token","database","query","connection","table","field"].some((e=>t.includes(e)))},findAssociatedValue:function(e){const t=e.querySelector("input, textarea, select")||e.nextElementSibling?.querySelector("input, textarea, select");if(t)return"checkbox"===t.type?t.checked:t.value||t.placeholder||null;let n=e.nextElementSibling,o=0;for(;n&&o<3;){const e=n.querySelector("input, textarea, select");if(e)return"checkbox"===e.type?e.checked:e.value||e.placeholder||null;const t=n.textContent?.trim();if(t&&t.length>0&&t.length<100&&!this.isParameterText(t))return t;n=n.nextElementSibling,o++}const r=e.closest(".parameter-item, .form-item, .field");if(r){const t=r.querySelector("input, textarea, select");if(t&&t!==e.querySelector("input, textarea, select"))return"checkbox"===t.type?t.checked:t.value||t.placeholder||null}return null},isNodeRelatedQuestion:function(e){const t=e.toLowerCase();return["setting","parameter","option","configure","setup","where","how to","what does","what is","prompt","model","format","output","input","authentication","auth","api key","token","timeout","retry","error","handle","connection","database","sql","query"].some((e=>t.includes(e)))},formatContextForAI:function(e){if(!e.isOpen)return null;let t=`CURRENT N8N NODE DETAILS:\n\n🔧 NODE INFORMATION:\n- Name: "${e.nodeName}"\n- Type: ${e.nodeType}\n- Category: ${e.nodeCategory||"General"}\n- Active Tab: ${e.activeTab}\n\n📋 PURPOSE & FUNCTION:`;if("code"===e.nodeType)if(t+="\nThis is a CODE node that executes custom JavaScript code within the n8n workflow. It's used for:\n- Data transformation and manipulation\n- Custom business logic implementation  \n- Complex calculations and processing\n- Integration between different data formats\n- Error handling and data validation",e.parameters["JavaScript Code"]){const n=e.parameters["JavaScript Code"];t+=`\n\n💻 CURRENT JAVASCRIPT CODE:\n\`\`\`javascript\n${n}\n\`\`\``;const o=n.split("\n").length,r=n.includes("return"),i=n.includes("console"),s=n.includes("error")||n.includes("Error"),a=n.includes("try")&&n.includes("catch");t+=`\n\n🔍 CODE ANALYSIS:\n- Lines of code: ${o}\n- Has return statement: ${r?"Yes":"No"}\n- Has console logging: ${i?"Yes":"No"}  \n- Contains error handling: ${s?"Yes":"No"}\n- Uses try-catch: ${a?"Yes":"No"}`}else t+="\n\n⚠️ JAVASCRIPT CODE: Not accessible or empty";else"ai-agent"===e.nodeType?t+="\nThis is an AI Agent node that connects to AI language models (like ChatGPT, Claude, etc.) to process text and generate responses. It's used for:\n- Text processing and generation\n- Content analysis and transformation  \n- Automated responses and chat functionality\n- Data extraction and formatting using AI":"http-request"===e.nodeType?t+="\nThis is an HTTP Request node that makes API calls to external services. It's used for:\n- Fetching data from REST APIs\n- Sending data to external systems\n- Webhook integrations\n- Third-party service communications":t+="\nThis node performs specific workflow automation tasks within the n8n platform.";if(Object.keys(e.parameters).length>0)if(t+="\n\n⚙️ CURRENT CONFIGURATION:","code"===e.nodeType){const n={},o={},r={};Object.entries(e.parameters).forEach((([e,t])=>{const i=e.toLowerCase();"JavaScript Code"!==e&&(i.includes("mode")||i.includes("execute")||i.includes("language")?n[e]=t:i.includes("error")||i.includes("fail")||i.includes("output")?o[e]=t:r[e]=t)})),Object.keys(n).length>0&&(t+="\n\n🔧 Execution Settings:",Object.entries(n).forEach((([e,n])=>{const o=this.formatParameterValue(n);t+=`\n  • ${e}: ${o}`}))),Object.keys(o).length>0&&(t+="\n\n⚡ Behavior Settings:",Object.entries(o).forEach((([e,n])=>{const o=this.formatParameterValue(n);t+=`\n  • ${e}: ${o}`}))),Object.keys(r).length>0&&(t+="\n\n📝 Other Settings:",Object.entries(r).forEach((([e,n])=>{const o=this.formatParameterValue(n);t+=`\n  • ${e}: ${o}`})))}else{const n={},o={};Object.entries(e.parameters).forEach((([e,t])=>{const r=e.toLowerCase();r.includes("prompt")||r.includes("url")||r.includes("method")||r.includes("model")||r.includes("format")||r.includes("auth")?n[e]=t:o[e]=t})),Object.keys(n).length>0&&(t+="\n\n📌 Key Settings:",Object.entries(n).forEach((([e,n])=>{const o=this.formatParameterValue(n);t+=`\n  • ${e}: ${o}`}))),Object.keys(o).length>0&&(t+="\n\n🔧 Additional Settings:",Object.entries(o).forEach((([e,n])=>{const o=this.formatParameterValue(n);t+=`\n  • ${e}: ${o}`})))}return e.detectedCapabilities.length>0&&(t+=`\n\n🚀 DETECTED CAPABILITIES:\n${e.detectedCapabilities.map((e=>`- ${e.replace("-"," ")}`)).join("\n")}`),e.availableOptions.length>0&&(t+=`\n\n⚡ AVAILABLE OPTIONS:\n${e.availableOptions.map((e=>`- ${e}`)).join("\n")}`),t+=`\n\n💡 CONTEXT FOR AI:\nThe user is currently configuring this specific "${e.nodeName}" node in their n8n workflow. \n🚨 IMPORTANT: The node is ALREADY OPEN and the user is looking at the ${e.activeTab} tab.\n\nCRITICAL INSTRUCTIONS:\n1. DO NOT tell user to "navigate to the node" or "open the node" - IT'S ALREADY OPEN\n2. DO NOT explain basic steps like "go to Parameters tab" - THEY'RE ALREADY THERE\n3. Focus ONLY on the specific parameter/setting they're asking about\n4. Use the EXACT parameter names from CURRENT CONFIGURATION above\n5. If a parameter shows a value, acknowledge it; if "(not set)", explain how to configure it`,"code"===e.nodeType?t+="\n\n🔧 CODE NODE SPECIFIC GUIDANCE:\n- The JavaScript code is the most important part of this node\n- Common issues: syntax errors, incorrect data access, missing return statements\n- Input data is accessed via $input.all() or $input.first()\n- Must return data in correct format for next node\n- Console.log() can be used for debugging\n- Available functions: $node, $workflow, $execution, $vars, etc.\n\nJAVASCRIPT ERROR ANALYSIS:\n- Look for syntax errors in the code above\n- Check if return statement is present and correct\n- Verify data access patterns ($input methods)\n- Check for undefined variables or functions\n- Analyze error handling implementation":t+='\n\nCOMMON MAPPINGS FOR AI AGENT NODE:\n- "системный промпт" / "system prompt" → "Prompt (User Message)" field\n- "промпт" / "prompt" → "Prompt (User Message)" field  \n- "сообщение" / "message" → "Source for Prompt (User Message)" field\n- "формат вывода" / "output format" → "Require Specific Output Format" setting\n- "модель" / "model" → Look for model selection in Options or Settings tab',t+='\n\nRESPONSE STYLE:\n- Skip navigation steps - user is already at the right place\n- Be direct and specific about the exact field/setting\n- If they ask "where to set X", just say "In the [exact parameter name] field"\n- Reference current values when relevant\n- For CODE nodes: Focus on the JavaScript code and its execution context',t},formatParameterValue:function(e){return null==e?"(not set)":"boolean"==typeof e?e?"enabled":"disabled":"string"==typeof e?""===e?"(empty)":"on"===e?"enabled":"off"===e?"disabled":e.length>50?`"${e.substring(0,47)}..."`:`"${e}"`:String(e)},debugCodeExtraction:function(){const e=this.findOpenNodePanel();if(!e)return;[".cm-editor",".monaco-editor",".code-editor",'[data-test-id*="code-editor"]','[data-test-id*="jsCode"]',".parameter-input-jsCode",'.parameter-input[data-test-id*="jsCode"]'].forEach((t=>{e.querySelectorAll(t).forEach(((e,t)=>{e.querySelector(".cm-content");const n=e.querySelectorAll(".cm-line");if(n.length>0){Array.from(n).map((e=>e.textContent)).join("\n")}}))}));e.querySelectorAll('[data-test-id*="parameter"], .parameter-input, .parameter-item').forEach(((e,t)=>{const n=e.className,o=e.getAttribute("data-test-id");e.textContent?.substring(0,100);if(n.includes("code")||o?.includes("code")||n.includes("jsCode")||o?.includes("jsCode")){this.extractFieldValue(e)}}))}};"undefined"!=typeof window&&(window.NodeContextAnalyzer=NodeContextAnalyzer,NodeContextAnalyzer.init());