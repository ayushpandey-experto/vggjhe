const I18nManager={currentLanguage:"en",supportedLanguages:["en","ru","es"],translations:{},async init(){try{const t=await chrome.storage.sync.get(["language"]);if(t.language&&this.supportedLanguages.includes(t.language))this.currentLanguage=t.language;else{const t=chrome.i18n.getUILanguage().split("-")[0];this.currentLanguage=this.supportedLanguages.includes(t)?t:"en",await chrome.storage.sync.set({language:this.currentLanguage})}await this.loadTranslations(this.currentLanguage),this.localizeDOM()}catch(t){this.currentLanguage="en",await this.loadTranslations("en")}},async loadTranslations(t){try{if(this.translations[t])return;const e=await fetch(chrome.runtime.getURL(`_locales/${t}/messages.json`));if(!e.ok)throw new Error(`Failed to load translations for ${t}`);const a=await e.json();this.translations[t]=a}catch(e){"en"===t||this.translations.en||await this.loadTranslations("en")}},getMessage(t,e=null){try{let a=this.translations[this.currentLanguage]?.[t]?.message;return a||"en"===this.currentLanguage||(a=this.translations.en?.[t]?.message),a?(e&&Array.isArray(e)&&e.forEach(((t,e)=>{a=a.replace(new RegExp(`\\$${e+1}`,"g"),t)})),a):t}catch(e){return t}},t(t,e=null){return this.getMessage(t,e)},getCurrentLanguage(){return this.currentLanguage},getBrowserLanguage:()=>chrome.i18n.getUILanguage(),getSupportedLanguages(){return this.supportedLanguages},async setLanguage(t){if(!this.supportedLanguages.includes(t))return!1;try{return await this.loadTranslations(t),this.currentLanguage=t,await chrome.storage.sync.set({language:t}),this.localizeDOM(),this.notifyLanguageChange(t),!0}catch(t){return!1}},localizeDOM(){try{document.querySelectorAll("[data-i18n]").forEach((t=>{const e=t.getAttribute("data-i18n");if(e){const a=this.getMessage(e);a!==e&&(t.textContent=a)}}));document.querySelectorAll("[data-i18n-placeholder]").forEach((t=>{const e=t.getAttribute("data-i18n-placeholder");if(e){const a=this.getMessage(e);a!==e&&(t.placeholder=a)}}));document.querySelectorAll("[data-i18n-title]").forEach((t=>{const e=t.getAttribute("data-i18n-title");if(e){const a=this.getMessage(e);a!==e&&(t.title=a)}}))}catch(t){}},notifyLanguageChange(t){try{const e=new CustomEvent("languageChanged",{detail:{language:t}});document.dispatchEvent(e),window.onLanguageChanged&&"function"==typeof window.onLanguageChanged&&window.onLanguageChanged(t)}catch(t){}},getLanguageName:t=>({en:"English",ru:"Русский",es:"Español"}[t]||t),format(t,...e){return this.getMessage(t,e)},isLanguageSupported(t){return this.supportedLanguages.includes(t)},getAllTranslations(){return this.translations[this.currentLanguage]||{}},getTranslationStats(){const t={};for(const e of this.supportedLanguages){const a=this.translations[e];t[e]=a?Object.keys(a).length:0}return t}};"undefined"!=typeof window&&(window.I18nManager=I18nManager);