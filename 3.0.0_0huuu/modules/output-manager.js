const OutputManager={config:{storageKey:"output_cache_global",selectors:{outputContainer:".cm-content",editOutputTab:'[role="tabpanel"]:has(.cm-content)',outputHeader:".el-input__suffix-inner",searchIcon:".el-input__suffix .el-icon-search",searchInput:'.el-input__inner[placeholder*="search"]',tabContainer:".el-tabs__content",outputSection:'[data-test-id*="output"]',codeEditor:".cm-editor"},ui:{selectId:"output-manager-select",saveButtonId:"output-manager-save",searchButtonId:"output-manager-search",deleteButtonId:"output-manager-delete",containerId:"output-manager-container",dialogId:"output-manager-dialog"},performance:{observerThrottle:1e3,retryDelay:2e3}},state:{isInitialized:!1,currentOutput:"",savedOutputs:{},isSearchVisible:!1,originalContainer:null,lastObserverTime:0,uiCreated:!1},init:async function(){if(!this.state.isInitialized)try{await this.loadSavedOutputs(),this.findAndAttachToOutput(),this.setupDOMObserver(),this.state.isInitialized=!0}catch(t){}},findAndAttachToOutput:function(){if(this.state.uiCreated&&document.getElementById(this.config.ui.containerId))return!0;const t=document.querySelectorAll(this.config.selectors.outputContainer);let e=null;for(const n of t){const t=this.isParameterEditor(n),o=this.isOutputEditor(n);if(!t&&o){e=n;break}}if(!e)return!1;let n=null;const o=e.closest(".cm-editor, .monaco-editor, .code-editor");if(o){let t=o.parentElement;for(;t&&t!==document.body;){const e=window.getComputedStyle(t);if("auto"===e.overflow||"scroll"===e.overflow||"auto"===e.overflowY||"scroll"===e.overflowY){n=t.parentElement;break}t=t.parentElement}n||(n=o.parentElement)}if(!n){const t=e.closest('[role="tabpanel"]');if(t&&!this.isParameterTabPanel(t)){let e=t.parentElement;for(;e&&e!==document.body;){const t=window.getComputedStyle(e);if("auto"===t.overflow||"scroll"===t.overflow||"auto"===t.overflowY||"scroll"===t.overflowY){n=e.parentElement;break}e=e.parentElement}n||(n=t)}}return!!n&&(this.createUI(n),this.setupEventListeners(),this.state.uiCreated=!0,!0)},isParameterEditor:function(t){let e=t;for(;e&&e!==document.body;){if(e.hasAttribute&&e.hasAttribute("data-test-id")){const t=e.getAttribute("data-test-id");if(t.includes("parameter")||t.includes("param"))return!0}if(e.className&&"string"==typeof e.className){const t=e.className.toLowerCase();if(t.includes("parameter")||t.includes("param")||t.includes("node-parameters")||t.includes("parameter-input"))return!0}const t=e.querySelectorAll("h1, h2, h3, h4, h5, h6, .tab-label, .section-title");for(const e of t){const t=e.textContent?.toLowerCase()||"";if(t.includes("parameter")||t.includes("param"))return!0}const n=e.querySelectorAll('.el-dialog__title, h1, h2, h3, h4, h5, h6, .title, .header, [class*="title"]');for(const t of n){if("edit javascript"===(t.textContent?.toLowerCase().trim()||""))return!1}e=e.parentElement}return!1},isOutputEditor:function(t){let e=t;for(;e&&e!==document.body;){if(e.hasAttribute&&e.hasAttribute("data-test-id")){const t=e.getAttribute("data-test-id");if(t.includes("expression")||t.includes("result"))return!1}if(e.className&&"string"==typeof e.className){const t=e.className.toLowerCase();if(t.includes("expression")||t.includes("expression-editor")||t.includes("expression-modal"))return!1}const t=e.querySelectorAll("h1, h2, h3, h4, h5, h6, .title, .header");for(const e of t){const t=e.textContent?.toLowerCase().trim()||"";if("expression"===t||"result"===t)return!1}e=e.parentElement}let n=!1;e=t;let o=0;for(;e&&e!==document.body&&o<10;){const t=["h1, h2, h3, h4, h5, h6",".title, .header, .section-title",'span[class*="title"], div[class*="title"]','span[class*="header"], div[class*="header"]','*[class*="_title_"]',"span, div"];let i=0;for(const o of t)try{const t=e.querySelectorAll(o);t.length>0&&(i+=t.length);for(let e=0;e<t.length;e++){const o=t[e],i=o.textContent?.trim()||"",a=i.toUpperCase(),r=o.getBoundingClientRect(),s=r.width>0&&r.height>0;if(("EDIT OUTPUT"===a||"OUTPUT"===a||"Edit Output"===i||"Output"===i)&&s){n=!0;break}}if(n)break}catch(t){}if(n)break;e=e.parentElement,o++}let i=!1;for(e=t;e&&e!==document.body;){if(e.hasAttribute&&e.hasAttribute("data-test-id")){const t=e.getAttribute("data-test-id");if(t.includes("code-node")||t.includes("code-editor")){const t=document.querySelectorAll(".el-tabs__item.is-active");for(const e of t){const t=e.textContent?.toLowerCase()||"";if(t.includes("output")||"edit output"===t){i=!0;break}}break}}e=e.parentElement}return!(!n&&!i)},isParameterTabPanel:function(t){const e=[".parameter-input",".node-parameters",'[data-test-id*="parameter"]',".param-container"];for(const n of e)if(t.querySelector(n))return!0;const n=t.closest(".el-tabs");if(n){const t=n.querySelectorAll(".el-tabs__item");for(const e of t){if((e.textContent?.toLowerCase()||"").includes("parameter")&&e.classList.contains("is-active"))return!0}}return!1},createUI:function(t){this.removeUI();const e=document.createElement("div");e.id=this.config.ui.containerId,e.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin: 8px 0;\n      padding: 8px 12px;\n      background: #2a2a2a;\n      border-radius: 6px;\n      border: 1px solid #444;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n      overflow: visible;\n      min-height: auto;\n      flex-shrink: 0;\n      flex-wrap: wrap;\n      position: relative;\n      z-index: 100;\n    ";const n=document.createElement("span");n.textContent="Output Templates:",n.style.cssText="\n      font-size: 12px;\n      color: #ccc;\n      font-weight: 500;\n      white-space: nowrap;\n    ";const o=document.createElement("select");o.id=this.config.ui.selectId,o.style.cssText="\n      min-width: 140px;\n      padding: 6px 10px;\n      border: 1px solid #555;\n      border-radius: 4px;\n      background: #333;\n      color: #fff;\n      font-size: 12px;\n      cursor: pointer;\n    ",this.populateSelect(o);const i=document.createElement("button");i.id=this.config.ui.deleteButtonId,i.innerHTML="❌",i.title="Delete selected template",i.style.cssText="\n      padding: 6px 8px;\n      border: 1px solid #cc4444;\n      border-radius: 4px;\n      background: #cc4444;\n      color: white;\n      cursor: pointer;\n      font-size: 12px;\n      min-width: 28px;\n      display: none;\n      align-items: center;\n      justify-content: center;\n      transition: background-color 0.2s;\n    ";const a=document.createElement("button");a.id=this.config.ui.saveButtonId,a.innerHTML="💾",a.title="Save current output as template",a.style.cssText="\n      padding: 6px 8px;\n      border: 1px solid #007acc;\n      border-radius: 4px;\n      background: #007acc;\n      color: white;\n      cursor: pointer;\n      font-size: 12px;\n      min-width: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background-color 0.2s;\n    ";const r=document.createElement("button");r.id=this.config.ui.searchButtonId,r.innerHTML="🔍",r.title="Search in output",r.style.cssText="\n      padding: 6px 8px;\n      border: 1px solid #555;\n      border-radius: 4px;\n      background: #444;\n      color: #ccc;\n      cursor: pointer;\n      font-size: 12px;\n      min-width: 28px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background-color 0.2s;\n    ",a.addEventListener("mouseenter",(()=>{a.style.backgroundColor="#0066aa"})),a.addEventListener("mouseleave",(()=>{a.style.backgroundColor="#007acc"})),r.addEventListener("mouseenter",(()=>{r.style.backgroundColor="#555"})),r.addEventListener("mouseleave",(()=>{r.style.backgroundColor="#444"})),i.addEventListener("mouseenter",(()=>{i.style.backgroundColor="#aa3333"})),i.addEventListener("mouseleave",(()=>{i.style.backgroundColor="#cc4444"})),e.appendChild(n),e.appendChild(o),e.appendChild(i),this.addExecutionSelectIfEnabled(e),e.appendChild(a),e.appendChild(r),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)},setupEventListeners:function(){const t=document.getElementById(this.config.ui.selectId),e=document.getElementById(this.config.ui.saveButtonId),n=document.getElementById(this.config.ui.searchButtonId),o=document.getElementById(this.config.ui.deleteButtonId);t&&t.addEventListener("change",(t=>{const e=t.target.value;this.onSelectChange(e),this.toggleDeleteButton(e)})),e&&e.addEventListener("click",(()=>{this.showSaveDialog()})),n&&n.addEventListener("click",(()=>{this.triggerSearch()})),o&&o.addEventListener("click",(()=>{this.deleteSelectedOutput()}))},toggleDeleteButton:function(t){const e=document.getElementById(this.config.ui.deleteButtonId);e&&(e.style.display=t&&""!==t?"flex":"none")},addExecutionSelectIfEnabled:async function(t){try{const e=await chrome.storage.local.get(["nodeExecutionSelect","n8nApiKey"]);if(!e.nodeExecutionSelect||!e.n8nApiKey)return;const n=document.createElement("div");n.style.cssText="\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        flex-wrap: wrap;\n      ";const o=document.createElement("select");o.id="n8n-execution-select",o.style.cssText="\n        min-width: 200px;\n        padding: 6px 10px;\n        border: 1px solid #555;\n        border-radius: 4px;\n        background: #333;\n        color: #fff;\n        font-size: 12px;\n        cursor: pointer;\n      ";const i=document.createElement("option");i.value="",i.textContent="Loading executions...",o.appendChild(i),n.appendChild(o),t.appendChild(n),this.loadExecutions(o),o.addEventListener("change",(t=>{this.onExecutionSelect(t.target.value)}))}catch(t){}},loadExecutions:async function(t){try{if(!(await chrome.storage.local.get(["n8nApiKey"])).n8nApiKey)return void this.updateExecutionSelect(t,[],"No API key configured");const e=this.getCurrentWorkflowId(),n=this.getCurrentNodeName();if(!n)return void this.updateExecutionSelect(t,[],"Unable to determine current node");let o=window.N8NApiClient;if(o||(await new Promise((t=>setTimeout(t,1e3))),o=window.N8NApiClient),o&&"function"==typeof o.getExecutionsForNode){o.initialized||await o.init();const i=await o.getExecutionsForNode(n,50,e);0===i.length?this.updateExecutionSelect(t,[],`No executions found for node "${n}"`):this.updateExecutionSelect(t,i)}else this.updateExecutionSelect(t,[],"API client not available")}catch(e){this.updateExecutionSelect(t,[],`Error: ${e.message}`)}},getCurrentWorkflowId:function(){try{const t=window.location.href.match(/\/workflow\/([^\/\?#]+)/);if(t&&t[1])return t[1];const e=window.location.pathname.match(/\/workflows?\/([^\/\?#]+)/);if(e&&e[1]&&"new"!==e[1])return e[1];const n=new URLSearchParams(window.location.search),o=n.get("workflow")||n.get("workflowId")||n.get("id");if(o)return o;if(window.location.hash){const t=window.location.hash.match(/workflow[\/=]([^\/\?&#]+)/);if(t&&t[1])return t[1]}const i=document.querySelectorAll('[data-test-id="breadcrumb-item"], .breadcrumb-item, .breadcrumb a');if(i.length>=2){const t=i[i.length-2],e=t.getAttribute("data-workflow-id")||t.getAttribute("data-id")||t.getAttribute("href")?.match(/workflow\/([^\/\?#]+)/)?.[1];if(e)return e}if(window.__VUE__&&window.__VUE__.$route&&window.__VUE__.$route.params){const t=window.__VUE__.$route.params.workflowId||window.__VUE__.$route.params.id||window.__VUE__.$route.params.workflow;if(t)return t}const a=document.querySelectorAll('[data-workflow-id], [data-workflow], [data-id*="workflow"]');for(const t of a){const e=t.getAttribute("data-workflow-id")||t.getAttribute("data-workflow")||t.getAttribute("data-id");if(e&&e.length>5)return e}return null}catch(t){return null}},updateExecutionSelect:function(t,e,n=null){if(t.innerHTML="",n){const e=document.createElement("option");return e.value="",e.textContent=n,e.disabled=!0,void t.appendChild(e)}const o=document.createElement("option");if(o.value="",o.textContent="Select execution...",t.appendChild(o),!e||0===e.length){const e=document.createElement("option");return e.value="",e.textContent="No executions found",e.disabled=!0,void t.appendChild(e)}e.forEach((e=>{const n=document.createElement("option");n.value=e.id;let o="⏳";!0===e.finished?o="✅":!1===e.finished&&(o="❌"),"manual"===e.mode&&(o+="🧪");const i=new Date(e.startedAt||e.createdAt),a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate());let s;if(new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime()===r.getTime())s=i.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});else{s=`${i.getMonth()+1}/${i.getDate()}/${i.getFullYear().toString().slice(-2)}, ${i.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}`}n.textContent=`${s} - ${o}`,t.appendChild(n)}))},onExecutionSelect:async function(t){if(t)try{if(!(await chrome.storage.local.get(["n8nApiKey"])).n8nApiKey)return void this.showExecutionWarning("No API key configured");window.location.href.split("/workflows")[0];await new Promise((t=>setTimeout(t,200)));let e=this.getCurrentNodeName();if(!e&&(await new Promise((t=>setTimeout(t,1e3))),e=this.getCurrentNodeName(),!e))return void this.showExecutionWarning("Unable to determine current node name. Make sure you are on a node settings page.");const n=window.N8NApiClient;if(n&&"function"==typeof n.getExecution){const o=await n.getExecution(t,!0),i=this.extractNodeDataFromExecution(o,e);i?this.setOutputContent(JSON.stringify(i,null,2)):this.showExecutionWarning(`There is no data for node '${e}' in the selected execution.`)}else this.showExecutionWarning("API client not available")}catch(t){this.showExecutionWarning("Error loading execution data")}},getCurrentNodeName:function(){try{const t=new URLSearchParams(window.location.search).get("node");if(t&&this.isValidNodeName(t))return t;const e=document.querySelectorAll('[data-test-id="breadcrumb-item"]');if(e.length>0){const t=e[e.length-1].textContent.trim();if(t&&"Workflow"!==t&&this.isValidNodeName(t))return t}const n=['[data-test-id="node-title"]',".node-settings-header h2",".node-settings-header h3",".node-parameters-wrapper h2",".node-parameters-wrapper h3",".node-settings .node-name",".parameter-input-list-wrapper h2",".parameter-input-list-wrapper h3"];for(const t of n){const e=document.querySelector(t);if(e){const t=e.textContent.trim();if(t&&this.isValidNodeName(t))return t}}const o=[".node-box.selected[data-node-name]",".node.selected[data-node-name]",".node-box.selected[data-name]",".node.selected[data-name]"];for(const t of o){const e=document.querySelector(t);if(e){const t=e.getAttribute("data-node-name")||e.getAttribute("data-name");if(t&&this.isValidNodeName(t))return t}}const i=window.location.pathname,a=window.location.hash,r=[/\/workflow\/[^\/]+\/node\/([^\/\?#]+)/,/\/node\/([^\/\?#]+)/,/#.*node[=\/]([^&\/#]+)/];for(const t of r){const e=i.match(t)||a.match(t);if(e&&e[1]&&this.isValidNodeName(e[1]))return e[1]}const s=[".panel-title",".node-title","h2:not(.context-menu h2):not(.dropdown h2)","h3:not(.context-menu h3):not(.dropdown h3)"];for(const t of s){const e=document.querySelectorAll(t);for(const t of e){if(this.isElementInContextMenu(t))continue;const e=t.textContent.trim();if(e&&this.isValidNodeName(e))return e}}return null}catch(t){return null}},isValidNodeName:function(t){if(!t||"string"!=typeof t)return!1;const e=t.trim(),n=[/^(Output|Input|Workflow|Parameters|Settings)$/i,/→/,/Right click/i,/N8N Master/i,/Generate Prompt/i,/Context Menu/i,/^[<>]/,/^\d+$/,/^(true|false|null|undefined)$/i,/^[\s]*$/];for(const t of n)if(t.test(e))return!1;return!(e.length<2||e.length>100)},isElementInContextMenu:function(t){if(!t)return!1;let e=t.parentElement,n=0;for(;e&&n<10;){const t=e.className||"",o=e.id||"";if(t.includes("context-menu")||t.includes("dropdown")||t.includes("tooltip")||t.includes("popup")||t.includes("modal")||t.includes("overlay")||o.includes("context")||o.includes("dropdown")||o.includes("popup"))return!0;const i=window.getComputedStyle(e);if(parseInt(i.zIndex)>1e3)return!0;e=e.parentElement,n++}return!1},extractNodeDataFromExecution:function(t,e){try{if(!t.data||!t.data.resultData||!t.data.resultData.runData)return null;const n=t.data.resultData.runData[e];if(!(n&&n[0]&&n[0].data&&n[0].data.main))return null;return n[0].data.main[0]}catch(t){return null}},showExecutionWarning:function(t){const e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #ff6b6b;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 6px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      z-index: 10000;\n      font-size: 14px;\n      max-width: 300px;\n    ",e.textContent=t,document.body.appendChild(e),setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e)}),5e3)},triggerSearch:function(){const t=document.querySelector(this.config.selectors.outputContainer);if(t){t.focus();const e=new KeyboardEvent("keydown",{key:"f",code:"KeyF",ctrlKey:!0,bubbles:!0});t.dispatchEvent(e)}},onSelectChange:function(t){if(!t)return;const e=this.state.savedOutputs[t];e&&this.setOutputContent(e.content)},setOutputContent:function(t){const e=document.querySelector(this.config.selectors.outputContainer);if(!e)return;let n=t;try{const e=JSON.parse(t);n=JSON.stringify(e,null,2)}catch(e){n=t}try{const t=e.closest(".cm-editor");if(t&&t.CodeMirror){const e=t.CodeMirror;if(e&&e.dispatch){const t=e.state.update({changes:{from:0,to:e.state.doc.length,insert:n}});return void e.dispatch(t)}}}catch(t){}try{if(e.closest(".monaco-editor")&&window.monaco){const t=window.monaco.editor.getModels();if(t.length>0){return void t[t.length-1].setValue(n)}}}catch(t){}try{let t=null,o=e;for(;o&&o.parentElement;){if(o.__vue__||o._vnode){t=o.__vue__||o._vnode.componentInstance;break}o=o.parentElement}if(t){if(t.updateValue)return void t.updateValue(n);if(t.setValue)return void t.setValue(n);if(t.$emit)return void t.$emit("input",n)}}catch(t){}try{e.focus();const t=document.createRange();t.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(t);const i=new KeyboardEvent("keydown",{key:"Delete",code:"Delete",bubbles:!0,cancelable:!0});e.dispatchEvent(i),e.textContent="";const a=n.split("\n");let r=0;const s=()=>{if(r<a.length){const t=a[r],n=document.createTextNode(t);e.appendChild(n),r<a.length-1&&e.appendChild(document.createTextNode("\n"));const o=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(o),r++,setTimeout(s,10)}else{const t=new Event("change",{bubbles:!0}),n=new Event("blur",{bubbles:!0});e.dispatchEvent(t),e.dispatchEvent(n)}};return void setTimeout(s,100)}catch(t){}e.textContent=n;["input","change","keyup","paste","textInput"].forEach((t=>{const n=new Event(t,{bubbles:!0,cancelable:!0});e.dispatchEvent(n)}))},getCurrentOutputContent:function(){const t=document.querySelector(this.config.selectors.outputContainer);return t&&t.textContent||""},showSaveDialog:function(){const t=this.getCurrentOutputContent();t.trim()?this.createSaveDialog(t):alert("⚠️ No output content to save")},createSaveDialog:function(t){const e=document.getElementById(this.config.ui.dialogId);e&&e.remove();const n=document.createElement("div");n.id=this.config.ui.dialogId,n.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.7);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ";const o=document.createElement("div");o.style.cssText="\n      background: #2a2a2a;\n      border-radius: 8px;\n      padding: 24px;\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n      min-width: 400px;\n      max-width: 500px;\n      border: 1px solid #444;\n    ";const i=document.createElement("h3");i.textContent="Save Output Template",i.style.cssText="\n      margin: 0 0 16px 0;\n      color: #fff;\n      font-size: 18px;\n    ";const a=document.createElement("input");a.type="text",a.placeholder="Specify a name for output template",a.style.cssText="\n      width: 100%;\n      padding: 12px;\n      border: 1px solid #555;\n      border-radius: 4px;\n      font-size: 14px;\n      margin-bottom: 16px;\n      box-sizing: border-box;\n      background: #333;\n      color: #fff;\n    ";const r=document.createElement("div");r.style.cssText="\n      display: flex;\n      gap: 12px;\n      justify-content: flex-end;\n    ";const s=document.createElement("button");s.textContent="Cancel",s.style.cssText="\n      padding: 8px 16px;\n      border: 1px solid #555;\n      border-radius: 4px;\n      background: #444;\n      color: #ccc;\n      cursor: pointer;\n      font-size: 14px;\n    ";const c=document.createElement("button");c.textContent="Save",c.disabled=!0,c.style.cssText="\n      padding: 8px 16px;\n      border: 1px solid #007acc;\n      border-radius: 4px;\n      background: #007acc;\n      color: white;\n      cursor: pointer;\n      font-size: 14px;\n      opacity: 0.5;\n    ",a.addEventListener("input",(t=>{const e=t.target.value.trim().length>0;c.disabled=!e,c.style.opacity=e?"1":"0.5",c.style.cursor=e?"pointer":"not-allowed"})),s.addEventListener("click",(()=>{n.remove()})),c.addEventListener("click",(async()=>{const e=a.value.trim();e&&(await this.saveOutput(e,t),n.remove())})),n.addEventListener("click",(t=>{t.target===n&&n.remove()})),r.appendChild(s),r.appendChild(c),o.appendChild(i),o.appendChild(a),o.appendChild(r),n.appendChild(o),document.body.appendChild(n),setTimeout((()=>a.focus()),100)},saveOutput:async function(t,e){if(t&&e){try{if(window.IndexedDBManager&&window.IndexedDBManager.db){const n={name:t,content:e};return await window.IndexedDBManager.saveOutputTemplate(n),await this.loadSavedOutputs(),void this.updateSelectOptions()}}catch(t){}this.state.savedOutputs[t]={content:e,timestamp:Date.now(),createdAt:(new Date).toISOString()},this.saveToChromeStorage(),this.updateSelectOptions()}},saveToChromeStorage:function(){try{chrome.storage.local.set({[this.config.storageKey]:this.state.savedOutputs},(()=>{chrome.runtime.lastError}))}catch(t){}},loadSavedOutputs:async function(){try{if(window.IndexedDBManager&&window.IndexedDBManager.db){const t=await window.IndexedDBManager.getAllOutputTemplates();this.state.savedOutputs={};for(const e of t)this.state.savedOutputs[e.name]={content:e.content,timestamp:e.timestamp,createdAt:e.createdAt};return}}catch(t){}try{chrome.storage.local.get(this.config.storageKey,(t=>{chrome.runtime.lastError||(this.state.savedOutputs=t[this.config.storageKey]||{})}))}catch(t){this.state.savedOutputs={}}},populateSelect:function(t){t.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="---",t.appendChild(e),Object.keys(this.state.savedOutputs).forEach((e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}))},updateSelectOptions:function(){const t=document.getElementById(this.config.ui.selectId);t&&this.populateSelect(t)},setupDOMObserver:function(){let t;new MutationObserver((()=>{const e=Date.now();e-this.state.lastObserverTime<this.config.performance.observerThrottle||(this.state.lastObserverTime=e,clearTimeout(t),t=setTimeout((()=>{this.state.uiCreated&&document.getElementById(this.config.ui.containerId)||this.findAndAttachToOutput()}),this.config.performance.retryDelay))})).observe(document.body,{childList:!0,subtree:!0})},removeUI:function(){const t=document.getElementById(this.config.ui.containerId);t&&t.remove();const e=document.getElementById(this.config.ui.dialogId);e&&e.remove(),this.state.uiCreated=!1},debug:function(){},debugEditor:function(){const t=document.querySelector(this.config.selectors.outputContainer);if(!t)return;const e=t.closest(".cm-editor");e&&e.CodeMirror;t.closest(".monaco-editor");window.monaco;let n=null,o=t;for(;o&&o.parentElement;){if(o.__vue__||o._vnode){n=o.__vue__||o._vnode.componentInstance;break}o=o.parentElement}},forceInit:function(){this.state.isInitialized=!1,this.state.uiCreated=!1,this.removeUI(),setTimeout((async()=>await this.init()),100)},deleteSelectedOutput:async function(){const t=document.getElementById(this.config.ui.selectId);if(!t||!t.value)return;const e=t.value;if(confirm(`Are you sure you want to delete the template "${e}"?`)){try{if(window.IndexedDBManager&&window.IndexedDBManager.db)return await window.IndexedDBManager.deleteOutputTemplateByName(e),await this.loadSavedOutputs(),this.updateSelectOptions(),this.toggleDeleteButton(""),void(t&&(t.value=""))}catch(t){}delete this.state.savedOutputs[e],this.saveToChromeStorage(),this.updateSelectOptions(),this.toggleDeleteButton(""),t&&(t.value="")}}};window.OutputManager=OutputManager,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{setTimeout((async()=>await OutputManager.init()),2e3)})):setTimeout((async()=>await OutputManager.init()),2e3);