const NodeCopyManager={isOpen:!1,currentWorkflows:[],currentNodes:[],selectedWorkflow:null,nodeTypeIcons:{"n8n-nodes-base.httpRequest":"üåê","n8n-nodes-base.scheduleTrigger":"üïí","n8n-nodes-base.webhook":"üì•","n8n-nodes-base.set":"üìù","n8n-nodes-base.if":"üîÄ","n8n-nodes-base.switch":"üö¶","n8n-nodes-base.code":"üíª","n8n-nodes-base.function":"‚öôÔ∏è","n8n-nodes-base.emailSend":"üìß","n8n-nodes-base.gmail":"üì©","n8n-nodes-base.slack":"üí¨","n8n-nodes-base.telegramBot":"ü§ñ","n8n-nodes-base.googleSheets":"üóÇÔ∏è","n8n-nodes-base.googleDrive":"üíΩ","n8n-nodes-base.googleCalendar":"üóìÔ∏è","n8n-nodes-base.googleContacts":"üì±","n8n-nodes-base.googleDocs":"üìù","n8n-nodes-base.mysql":"üóÑÔ∏è","n8n-nodes-base.postgres":"üêò","n8n-nodes-base.mongodb":"üçÉ","n8n-nodes-base.redis":"üî¥","n8n-nodes-base.openAi":"ü§ñ","n8n-nodes-base.stickyNote":"üìÑ","n8n-nodes-base.splitOut":"‚úÇ","n8n-nodes-base.wait":"‚è≥","n8n-nodes-base.aggregate":"üîÇ","@n8n/n8n-nodes-langchain.agent":"ü§ñ","n8n-nodes-base.anthropic":"üß†",openai:"ü§ñ",anthropic:"üß†","ai-agent":"ü§ñ",default:"üì¶"},async init(){try{window.N8NApiClient;await this.checkApiKey();await this.createCopyButton(),await this.createCopyInterface(),this.setupNodeMonitoring();return 0===document.querySelectorAll(".node-copy-button").length&&(setTimeout((()=>this.createCopyButton()),2e3),setTimeout((()=>this.createCopyButton()),5e3),setTimeout((()=>this.createCopyButton()),1e4)),!0}catch(e){return!1}},async checkApiKey(){try{const e=await chrome.storage.local.get(["n8nApiKey"]);return!(!e.n8nApiKey||!e.n8nApiKey.trim())}catch(e){return!1}},async checkNodeSelectorEnabled(){try{return!!(await chrome.storage.local.get(["nodeSelector"])).nodeSelector}catch(e){return!1}},async createCopyButton(){await this.waitForElement('[data-test-id="canvas-handle-plus"], [data-test-id="add-node-button"], .add-node-button');let e=document.querySelectorAll('[data-test-id="canvas-handle-plus"]');if(0===e.length&&(e=document.querySelectorAll('[data-test-id="add-node-button"]')||document.querySelectorAll(".add-node-button")),0===e.length&&(e=document.querySelectorAll("g._plus_hyidj_129")||document.querySelectorAll("g.source.clickable")||document.querySelectorAll('[class*="plus"]')),0===e.length)return document.querySelectorAll("[data-test-id]").forEach((e=>{})),void setTimeout((()=>this.createCopyButton()),2e3);e.forEach(((e,n)=>{this.createSingleCopyButton(e,n)}))},createSingleCopyButton(e,n){const t=`node-copy-button-${n}`;if(document.getElementById(t))return;const o=document.createElement("div");o.id=t,o.className="node-copy-button",o.title=window.I18nManager?window.I18nManager.getMessage("copyNodeFromTemplate"):"Copy node from template",o.style.cssText="\n        position: fixed;\n        z-index: 9999;\n        width: 24px;\n        height: 24px;\n        background: var(--color-foreground-xlight);\n        border: 2px solid var(--color-foreground-xdark);\n        border-radius: 4px;\n        cursor: pointer;\n        display: none;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s ease;\n        font-size: 12px;\n        font-weight: bold;\n        color: var(--color-foreground-xdark);\n      ",o.innerHTML='\n        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">\n          <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ';const a=()=>{if(document.body.contains(e)&&document.body.contains(o)){const n=e.getBoundingClientRect();o.style.left=n.right+5+"px",o.style.top=n.top+"px"}};a(),this.setupHoverLogic(e,o,n),o.addEventListener("mouseenter",(()=>{o.style.background="#005a9e",o.style.transform="scale(1.05)"})),o.addEventListener("mouseleave",(()=>{o.style.background="#007acc",o.style.transform="scale(1)"})),o.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.toggleCopyInterface(o)})),document.body.appendChild(o),window.addEventListener("resize",a),window.addEventListener("scroll",a);const r=document.querySelector('#workflow-canvas, .workflow-canvas, [data-test-id="canvas"]');if(r){const e=new MutationObserver(a);e.observe(r,{attributes:!0,attributeFilter:["style","transform"],subtree:!0}),o._observer=e}o._updatePosition=a;const s=setInterval((()=>{document.body.contains(o)?a():clearInterval(s)}),500);o._positionInterval=s},setupHoverLogic(e,n,t){let o,a=!1;e.addEventListener("mouseenter",(()=>{clearTimeout(o),o=setTimeout((()=>{a||(n.style.display="flex")}),500)})),e.addEventListener("mouseleave",(e=>{clearTimeout(o),n.contains(e.relatedTarget)||a||setTimeout((()=>{n.matches(":hover")||a||(n.style.display="none")}),2e3)})),n.addEventListener("mouseleave",(t=>{e.contains(t.relatedTarget)||a||setTimeout((()=>{e.matches(":hover")||a||(n.style.display="none")}),200)})),n.addEventListener("click",(()=>{a=!0,n.style.display="flex"})),e.addEventListener("click",(e=>{this.closeCopyInterface(),a=!1,n.style.display="none"})),document.addEventListener("click",(t=>{const o=document.getElementById("node-copy-interface");!o||o.contains(t.target)||n.contains(t.target)||(a=!1,e.matches(":hover")||n.matches(":hover")||(n.style.display="none"))}))},setupNodeMonitoring(){let e=0;const n=()=>{const n=document.querySelectorAll('[data-test-id="canvas-handle-plus"]').length;n>e?(e=n,this.createCopyButton()):n<e&&(e=n,this.cleanupOrphanedButtons())},t=new MutationObserver((e=>{let t=!1;e.forEach((e=>{e.addedNodes.length>0&&e.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&(e.getAttribute&&"canvas-handle-plus"===e.getAttribute("data-test-id")||e.querySelector&&e.querySelector('[data-test-id="canvas-handle-plus"]')||e.querySelector&&e.querySelector('[data-test-id="canvas-node"]'))&&(t=!0)})),e.removedNodes.length>0&&e.removedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&(e.getAttribute&&"canvas-handle-plus"===e.getAttribute("data-test-id")||e.querySelector&&e.querySelector('[data-test-id="canvas-handle-plus"]'))&&(t=!0)}))})),t&&(setTimeout(n,300),setTimeout(n,800),setTimeout(n,1500))})),o=document.querySelector('#workflow-canvas, .workflow-canvas, [data-test-id="canvas"]')||document.body;t.observe(o,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-test-id","class"]}),setTimeout((()=>{const n=document.querySelectorAll('[data-test-id="canvas-handle-plus"]');e=n.length}),1e3),setInterval((()=>{n()}),5e3)},cleanupOrphanedButtons(){const e=document.querySelectorAll(".node-copy-button"),n=document.querySelectorAll('[data-test-id="canvas-handle-plus"]');e.forEach(((e,t)=>{n[t]||e.remove()}))},async createCopyInterface(){if(document.getElementById("node-copy-interface"))return;const e=document.createElement("div");e.id="node-copy-interface",e.style.cssText="\n        position: fixed;\n        top: 50px;\n        right: 20px;\n        width: 410px;\n        height: 600px;\n        background: #1e1e1e;\n        border-radius: 8px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.6), 0 0 0 1px #333333;\n        z-index: 10000;\n        display: none;\n        flex-direction: column;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        transition: all 0.3s ease;\n        border: 1px solid #333333;\n        pointer-events: auto;\n        backdrop-filter: blur(10px);\n        user-select: none;\n      ",e.innerHTML=`\n        <div id="workflow-panel" style="display: flex; flex-direction: column; height: 100%;">\n          <div class="drag-header" style="padding: 11px 13px; border-bottom: 1px solid #333333; background: #2a2a2a; color: #ffffff; border-radius: 8px 8px 0 0; cursor: move;">\n            <h3 style="margin: 0 0 8px 0; color: #ffffff; font-size: 16px; font-weight: 600; pointer-events: none;">Workflows</h3>\n                          <div style="position: relative; pointer-events: none;">\n                <input \n                  id="workflow-search" \n                  type="text" \n                  placeholder="${window.I18nManager?window.I18nManager.getMessage("searchWorkflows"):"Search workflows..."}"\n                  style="width: 100%; padding: 5px 30px 5px 8px; border: 1px solid #444444; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.2s; background: #1e1e1e; color: #ffffff; box-sizing: border-box; pointer-events: auto;"\n                />\n                <button \n                  id="workflow-search-clear"\n                  style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #888; font-size: 14px; cursor: pointer; padding: 2px; display: none; pointer-events: auto;"\n                  title="${window.I18nManager?window.I18nManager.getMessage("clearSearch"):"Clear search"}"\n                >‚úï</button>\n              </div>\n          </div>\n          <div id="workflow-list" style="flex: 1; padding: 11px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; background: #2d2d2d;">\n            <div style="color: #888; text-align: center; padding: 20px; font-size: 14px;">${window.I18nManager?window.I18nManager.getMessage("loadingWorkflows"):"Loading workflows..."}</div>\n          </div>\n        </div>\n        \n                <div id="node-panel" style="display: none; flex-direction: column; height: 100%;">\n            <div class="drag-header" style="padding: 11px 13px; border-bottom: 1px solid #333333; background: #2a2a2a; color: #ffffff; border-radius: 8px 8px 0 0; cursor: move;">\n              <div style="display: flex; align-items: center; margin-bottom: 8px; pointer-events: none;">\n                <button id="back-to-workflows" style="background: none; border: none; color: #ffffff; cursor: pointer; margin-right: 8px; font-size: 18px; padding: 3px; pointer-events: auto;">‚Üê</button>\n                <div>\n                  <h3 style="margin: 0 0 3px 0; color: #ffffff; font-size: 16px; font-weight: 600;">Nodes</h3>\n                  <div id="selected-workflow-name" style="color: #a0a0a0; font-size: 13px;"></div>\n                </div>\n              </div>\n              <div style="position: relative; pointer-events: none;">\n                <input \n                  id="node-search" \n                  type="text" \n                  placeholder="${window.I18nManager?window.I18nManager.getMessage("searchNodes"):"Search nodes..."}"\n                  style="width: 100%; padding: 5px 30px 5px 8px; border: 1px solid #444444; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.2s; background: #1e1e1e; color: #ffffff; box-sizing: border-box; pointer-events: auto;"\n                />\n                <button \n                  id="node-search-clear"\n                  style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #888; font-size: 14px; cursor: pointer; padding: 2px; display: none; pointer-events: auto;"\n                  title="${window.I18nManager?window.I18nManager.getMessage("clearSearch"):"Clear search"}"\n                >‚úï</button>\n              </div>\n            </div>\n            <div id="node-list" style="flex: 1; padding: 11px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; background: #2d2d2d;">\n              <div style="color: #888; text-align: center; padding: 20px; font-size: 14px;">${window.I18nManager?window.I18nManager.getMessage("loadingNodes"):"Loading nodes..."}</div>\n            </div>\n          </div>\n      `,document.body.appendChild(e),this.setupEventListeners(),this.setupDragFunctionality()},setupEventListeners(){const e=document.getElementById("workflow-search"),n=document.getElementById("workflow-search-clear");e&&e.addEventListener("input",(e=>{const t=e.target.value;this.filterWorkflows(t),n.style.display=t?"block":"none"})),n&&n.addEventListener("click",(()=>{e.value="",n.style.display="none",this.filterWorkflows("")}));const t=document.getElementById("node-search"),o=document.getElementById("node-search-clear");t&&t.addEventListener("input",(e=>{const n=e.target.value;this.filterNodes(n),o.style.display=n?"block":"none"})),o&&o.addEventListener("click",(()=>{t.value="",o.style.display="none",this.filterNodes("")}));const a=document.getElementById("back-to-workflows");a&&a.addEventListener("click",(()=>{this.showWorkflowPanel()})),document.addEventListener("click",(e=>{const n=document.getElementById("node-copy-interface"),t=document.querySelectorAll(".node-copy-button");if(n&&"block"===n.style.display){let o=!1;t.forEach((n=>{n.contains(e.target)&&(o=!0)})),n.contains(e.target)||o||this.closeCopyInterface()}}))},setupDragFunctionality(){const e=document.getElementById("node-copy-interface");if(!e)return;let n=!1,t={x:0,y:0};const o=e.querySelectorAll(".drag-header");o.forEach((o=>{o.addEventListener("mousedown",(o=>{if("INPUT"===o.target.tagName||"BUTTON"===o.target.tagName)return;n=!0;const a=e.getBoundingClientRect();t.x=o.clientX-a.left,t.y=o.clientY-a.top,e.style.cursor="move",document.body.style.cursor="move",o.preventDefault()}))})),document.addEventListener("mousemove",(o=>{if(!n)return;o.preventDefault();const a=o.clientX-t.x,r=o.clientY-t.y,s=window.innerWidth,i=window.innerHeight,d=e.offsetWidth,l=e.offsetHeight,c=Math.max(0,Math.min(a,s-d)),p=Math.max(0,Math.min(r,i-l));e.style.left=c+"px",e.style.top=p+"px",e.style.right="auto"})),document.addEventListener("mouseup",(()=>{n&&(n=!1,e.style.cursor="",document.body.style.cursor="")})),o.forEach((e=>{e.addEventListener("mouseenter",(t=>{n||t.target.closest("input")||t.target.closest("button")||(e.style.cursor="move")})),e.addEventListener("mouseleave",(()=>{n||(e.style.cursor="move")}))}))},async toggleCopyInterface(e){const n=document.getElementById("node-copy-interface");if(!n)return await this.createCopyInterface(),this.toggleCopyInterface(e);"none"!==n.style.display&&n.style.display?this.closeCopyInterface():this.openCopyInterface(e)},async openCopyInterface(e){const n=document.getElementById("node-copy-interface");if(!n)return;if(await this.checkApiKey()){if(e){const t=e.getBoundingClientRect();n.style.left=t.left+"px",n.style.top=t.bottom+5+"px"}n.style.display="block",this.isOpen=!0,this.currentClickedButton=e,e&&(e.innerHTML='\n          <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">\n            <path d="M9 7.5L6 4.5L3 7.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>\n          </svg>\n        '),await this.loadWorkflows()}else this.showApiKeyRequiredMessage()},showApiKeyRequiredMessage(){const e=document.createElement("div");e.style.cssText="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: #1e1e1e;\n        border: 2px solid #ff4757;\n        border-radius: 12px;\n        padding: 24px;\n        z-index: 10001;\n        max-width: 400px;\n        color: #fff;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.5);\n        text-align: center;\n      ",e.innerHTML=`\n        <div style="font-size: 24px; margin-bottom: 16px;">üîë</div>\n        <h3 style="margin: 0 0 12px 0; color: #ff6b7a; font-size: 16px;">${window.I18nManager?window.I18nManager.getMessage("n8nApiKeyRequired"):"N8N API Key Required"}</h3>\n        <p style="margin: 0 0 16px 0; color: #ccc; font-size: 14px; line-height: 1.4;">\n          ${window.I18nManager?window.I18nManager.getMessage("n8nApiKeyRequiredMessage"):"To copy nodes from other workflows, please configure your N8N API key in the extension settings."}\n        </p>\n        <button \n          id="open-settings-btn"\n          style="\n            background: #ff4757;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 600;\n            margin-right: 10px;\n          ">\n          ${window.I18nManager?window.I18nManager.getMessage("openSettings"):"Open Settings"}\n        </button>\n        <button \n          id="close-notification-btn"\n          style="\n            background: #666;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-weight: 600;\n          ">\n          ${window.I18nManager?window.I18nManager.getMessage("close"):"Close"}\n        </button>\n      `,document.body.appendChild(e),document.getElementById("open-settings-btn").addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"openPopup"}),document.body.removeChild(e)})),document.getElementById("close-notification-btn").addEventListener("click",(()=>{document.body.removeChild(e)})),setTimeout((()=>{document.body.contains(e)&&document.body.removeChild(e)}),8e3)},showWorkflowPanel(){const e=document.getElementById("workflow-panel"),n=document.getElementById("node-panel");e&&(e.style.display="flex"),n&&(n.style.display="none")},showNodePanel(e){const n=document.getElementById("workflow-panel"),t=document.getElementById("node-panel"),o=document.getElementById("selected-workflow-name");n&&(n.style.display="none"),t&&(t.style.display="flex"),o&&(o.textContent=e)},closeCopyInterface(){const e=document.getElementById("node-copy-interface");if(!e)return;e.style.display="none",this.isOpen=!1;const n=document.getElementById("workflow-search"),t=document.getElementById("node-search"),o=document.getElementById("workflow-search-clear"),a=document.getElementById("node-search-clear");n&&(n.value="",o&&(o.style.display="none")),t&&(t.value="",a&&(a.style.display="none")),this.showWorkflowPanel(),this.currentClickedButton&&(this.currentClickedButton.innerHTML='\n          <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">\n            <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>\n          </svg>\n        ',this.currentClickedButton=null)},async loadWorkflows(){const e=document.getElementById("workflow-list");if(e)try{e.innerHTML=`<div style="color: #888; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("loadingWorkflows"):"Loading workflows..."}</div>`;const n=this.getCurrentWorkflowId();let t;if(window.N8NApiClient){const e=await window.N8NApiClient.getWorkflows();t=e&&e.data&&Array.isArray(e.data)?e.data:Array.isArray(e)?e:[]}else t=[{id:"1",name:"Sample Workflow 1",nodes:[{},{},{}]},{id:"2",name:"Sample Workflow 2",nodes:[{},{}]},{id:"3",name:"Test Workflow",nodes:[{}]}];Array.isArray(t)||(t=[]);let o=t;if(n&&(o=t.filter((e=>{const t=String(e.id)===String(n);return!t}))),0===o.length)return void(n&&t.length>0?e.innerHTML=`<div style="color: #888; text-align: center; padding: 20px; line-height: 1.4;">${window.I18nManager?window.I18nManager.getMessage("noOtherWorkflowsAvailable"):"No other workflows available.<br/>Create more workflows to copy nodes between them."}</div>`:e.innerHTML=`<div style="color: #888; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("noWorkflowsFound"):"No workflows found"}</div>`);this.currentWorkflows=o,this.renderWorkflows(o)}catch(n){e.innerHTML=`<div style="color: #f44; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("failedToLoadWorkflows"):"Failed to load workflows"}</div>`}},renderWorkflows(e,n=""){const t=document.getElementById("workflow-list");if(!t)return;const o=n?e.filter((e=>e.name.toLowerCase().includes(n.toLowerCase()))):e;0!==o.length?(t.innerHTML=o.map((e=>`\n        <div \n          class="workflow-item"\n          data-workflow-id="${e.id}"\n          style="\n            background: #3a3a3a;\n            border: 1px solid #444444;\n            border-radius: 8px;\n            padding: 11px;\n            cursor: pointer;\n            transition: border-color 0.2s, background 0.2s;\n          "\n          onmouseenter="this.style.borderColor='#4a90e2'; this.style.background='#424242';" \n          onmouseleave="this.style.borderColor='#444444'; this.style.background='#3a3a3a';"\n        >\n          <div style="font-weight: 600; font-size: 14px; color: #ffffff; line-height: 1.3; margin-bottom: 5px;">\n            ${this.escapeHtml(e.name)}\n          </div>\n          <div style="font-size: 13px; color: #cccccc; line-height: 1.4;">\n            ${e.nodes?e.nodes.length:0} nodes\n          </div>\n        </div>\n      `)).join(""),t.querySelectorAll(".workflow-item").forEach((e=>{e.addEventListener("click",(()=>{const n=e.getAttribute("data-workflow-id");this.selectWorkflow(n)}))}))):t.innerHTML=`<div style="color: #888; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("noWorkflowsMatchSearch"):"No workflows match search"}</div>`},async selectWorkflow(e){const n=document.getElementById("node-list");if(n)try{document.querySelectorAll(".workflow-item").forEach((e=>{e.style.borderLeftColor="#007acc",e.style.background="#333"}));const t=document.querySelector(`[data-workflow-id="${e}"]`);t&&(t.style.borderLeftColor="#00ff88",t.style.background="#2a4a2a"),n.innerHTML=`<div style="color: #888; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("loadingNodes"):"Loading nodes..."}</div>`;const o=await window.N8NApiClient.getWorkflowById(e);if(!o||!o.nodes)return void(n.innerHTML=`<div style="color: #f44; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("noNodesFound"):"No nodes found"}</div>`);this.selectedWorkflow=o,this.currentNodes=Array.isArray(o.nodes)?o.nodes:Object.values(o.nodes),this.showNodePanel(o.name),this.renderNodes(this.currentNodes)}catch(e){n.innerHTML=`<div style="color: #f44; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("failedToLoadNodes"):"Failed to load nodes"}</div>`}},renderNodes(e,n=""){const t=document.getElementById("node-list");if(!t)return;const o=n?e.filter((e=>e.name.toLowerCase().includes(n.toLowerCase())||e.type.toLowerCase().includes(n.toLowerCase()))):e;0!==o.length?(t.innerHTML=o.map((e=>`\n        <div \n          class="node-item"\n          data-node-id="${e.id}"\n          title="${e.type}"\n          style="\n            background: #3a3a3a;\n            border: 1px solid #444444;\n            border-radius: 8px;\n            padding: 11px;\n            transition: border-color 0.2s, background 0.2s;\n          "\n          onmouseenter="this.style.borderColor='#4a90e2'; this.style.background='#424242';" \n          onmouseleave="this.style.borderColor='#444444'; this.style.background='#3a3a3a';"\n        >\n          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px;">\n            <div style="font-weight: 600; font-size: 14px; color: #ffffff; line-height: 1.3; flex: 1; margin-right: 8px; display: flex; align-items: center;">\n              <span style="margin-right: 5px; font-size: 16px;">\n                ${this.getNodeIcon(e.type)}\n              </span>\n              ${this.escapeHtml(e.name)}\n            </div>\n            <button \n              class="copy-node-btn"\n              style="\n                background: #4a90e2;\n                border: none;\n                color: white;\n                padding: 6px 12px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 12px;\n                font-weight: 500;\n                transition: background 0.2s;\n                white-space: nowrap;\n              "\n              onmouseenter="this.style.background='#5ca0f2';" \n              onmouseleave="this.style.background='#4a90e2';"\n            >\n              ${window.I18nManager?window.I18nManager.getMessage("copy"):"Copy"}\n            </button>\n          </div>\n          <div style="font-size: 13px; color: #cccccc; line-height: 1.4;">\n            Node connecting ${e.type.replace("n8n-nodes-base.","")}${e.parameters?", "+Object.keys(e.parameters).join(", "):""}\n          </div>\n        </div>\n      `)).join(""),t.querySelectorAll(".copy-node-btn").forEach((e=>{e.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation();const t=e.closest(".node-item").getAttribute("data-node-id");this.copyNode(t)}))}))):t.innerHTML=`<div style="color: #888; text-align: center; padding: 20px;">${window.I18nManager?window.I18nManager.getMessage("noNodesMatchSearch"):"No nodes match search"}</div>`},getNodeIcon(e){if(this.nodeTypeIcons[e])return this.nodeTypeIcons[e];const n=e.toLowerCase();for(const[e,t]of Object.entries(this.nodeTypeIcons))if(n.includes(e.toLowerCase())||e.toLowerCase().includes(n))return t;return this.nodeTypeIcons.default},isAIAgentNode:e=>e.type&&(e.type.includes("agent")||e.type.includes("langchain.agent")||"@n8n/n8n-nodes-langchain.agent"===e.type),findConnectedToolNodes(e){const n=[],t=this.selectedWorkflow.connections||{};for(const[o,a]of Object.entries(t))if(a.ai_tool||a.ai_languageModel){if([...a.ai_tool||[],...a.ai_languageModel||[]].some((n=>n.some((n=>n.node===e.name))))){const e=this.currentNodes.find((e=>e.name===o));e&&n.push(e)}}return n},async copyNode(e){try{const n=this.currentNodes.find((n=>n.id===e));if(!n)return;const t=this.isAIAgentNode(n);let o=[n],a=`Node "${n.name}"`;if(t){const e=this.findConnectedToolNodes(n);e.length>0&&(o=[n,...e],a=window.I18nManager?window.I18nManager.getMessage("aiAgentWithTools").replace("{nodeName}",n.name).replace("{toolCount}",e.length):`AI Agent "${n.name}" with ${e.length} tools`)}const r=await this.createWorkflowWithNodes(o);this.closeCopyInterface();if(await this.addNodesToN8nWorkflow(r))this.showNotification("success",`‚úÖ ${a} ${window.I18nManager?window.I18nManager.getMessage("nodeCopiedSuccessfully"):"copied successfully and added to workflow!"}`);else{await this.copyWorkflowToClipboard(r);const e=window.I18nManager?window.I18nManager.getMessage("nodeNameCopiedToClipboard").replace("{nodeName}",n.name):`Node "${n.name}" copied to clipboard. Use Ctrl+V to paste in n8n.`;this.showNotification("success",`‚úÖ ${e}`)}}catch(e){this.showNotification("error",`‚ùå ${window.I18nManager?window.I18nManager.getMessage("failedToCopyNode"):"Failed to copy node:"} ${e.message}`)}},async createWorkflowWithNodes(e){const n=new Map,t=[],o={};e.forEach(((e,t)=>{const o="copied_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)+"_"+t;n.set(e.id,o),n.set(e.name,e.name+" (Copy)")})),e.forEach(((e,o)=>{const a=n.get(e.id),r=n.get(e.name),s={...e,id:a,name:r,position:[(e.position&&e.position[0]?e.position[0]:100)+200,(e.position&&e.position[1]?e.position[1]:100)+50*o],credentials:e.credentials||{}};t.push(s)}));const a=this.selectedWorkflow.connections||{};return e.forEach((t=>{const r=n.get(t.name),s=a[t.name];if(s){const t={};for(const[o,a]of Object.entries(s))t[o]=a.map((t=>t.map((t=>{const o=t.node;return e.find((e=>e.name===o))?{...t,node:n.get(o)}:null})).filter((e=>null!==e)))).filter((e=>e.length>0));Object.keys(t).length>0&&(o[r]=t)}else o[r]={main:[[]]}})),{nodes:t,connections:o,pinData:{},meta:{templateCredsSetupCompleted:!0,instanceId:this.generateInstanceId()}}},async addNodesToN8nWorkflow(e){try{if(await this.addNodesViaVueStore(e))return!0;return!!await this.addNodesViaUI(e)}catch(e){return!1}},async addNodeToN8nWorkflow(e){const n={nodes:[e],connections:{[e.name]:{main:[[]]}},pinData:{},meta:{templateCredsSetupCompleted:!0,instanceId:this.generateInstanceId()}};return await this.addNodesToN8nWorkflow(n)},getCurrentWorkflowId(){try{const e=window.location.pathname.match(/\/workflow\/([^\/]+)/);if(e&&e[1]&&"new"!==e[1])return e[1];const n=window.location.hash.match(/#\/workflow\/([^\/]+)/);if(n&&n[1]&&"new"!==n[1])return n[1];try{const e=document.querySelector("#app").__vue__;if(e&&e.$store){const n=e.$store.getters.workflowId||e.$store.state.workflows?.workflowId||e.$store.state.ui?.workflowId;if(n&&"new"!==n)return n}}catch(e){}try{const e=document.title.match(/^(.+?)\s*-\s*n8n/);e&&e[1]&&e[1]}catch(e){}return null}catch(e){return null}},async addNodesViaVueStore(e){try{const n=document.querySelector("#app").__vue__;if(!n||!n.$store)return!1;const t=["workflows/addWorkflow","workflows/mergeWorkflow","ui/pasteNodes","canvas/pasteNodes","pasteWorkflow","addWorkflow"];for(const o of t)try{return await n.$store.dispatch(o,e),!0}catch(e){}for(const n of e.nodes){if(!await this.addNodeViaVueStore(n))return!1}return!0}catch(e){return!1}},async addNodeViaVueStore(e){try{const n=document.querySelector("#app").__vue__;if(!n||!n.$store)return!1;const t=["ui/addNode","workflows/addNode","canvas/addNode","addNode","createNode","ui/createNode"];for(const o of t)try{return await n.$store.dispatch(o,e),!0}catch(e){}return!1}catch(e){return!1}},async addNodesViaUI(e){try{document.querySelector('#workflow-canvas, [data-test-id="canvas"]');return!1}catch(e){return!1}},async addNodeViaUI(e){try{document.querySelector('#workflow-canvas, [data-test-id="canvas"]');return!1}catch(e){return!1}},async copyWorkflowToClipboard(e){try{await navigator.clipboard.writeText(JSON.stringify(e,null,2))}catch(e){}},async copyNodeToClipboard(e){try{const n={nodes:[{parameters:e.parameters||{},type:e.type,typeVersion:e.typeVersion||1,position:e.position||[100,100],id:e.id,name:e.name,...e.webhookId&&{webhookId:e.webhookId},...e.credentials&&Object.keys(e.credentials).length>0&&{credentials:e.credentials}}],connections:{[e.name]:{main:[[]]}},pinData:{},meta:{templateCredsSetupCompleted:!0,instanceId:this.generateInstanceId()}};await this.copyWorkflowToClipboard(n)}catch(e){}},generateInstanceId:()=>"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,(function(){return(16*Math.random()|0).toString(16)})),filterWorkflows(e){this.renderWorkflows(this.currentWorkflows,e)},filterNodes(e){this.renderNodes(this.currentNodes,e)},showNotification(e,n){const t=document.getElementById("n8n-master-notification");t&&t.remove();const o=document.createElement("div");o.id="n8n-master-notification",o.style.cssText="\n        position: fixed;\n        bottom: 30%;\n        left: 50%;\n        transform: translateX(-50%);\n        padding: 12px 20px;\n        border-radius: 8px;\n        color: white;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 99999;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        max-width: 400px;\n        text-align: center;\n        transition: all 0.3s ease;\n      ";const a={processing:"#ff8c00",success:"#28a745",error:"#dc3545"};if(o.style.backgroundColor=a[e]||a.processing,o.textContent=n,document.body.appendChild(o),"processing"===e){o.style.position="relative",o.style.overflow="hidden";const e=document.createElement("div");e.style.cssText="\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          height: 3px;\n          background: rgba(255,255,255,0.3);\n          animation: loading 2s infinite;\n        ";const n=document.createElement("style");n.textContent="\n          @keyframes loading {\n            0% { width: 0%; }\n            50% { width: 100%; }\n            100% { width: 0%; }\n          }\n        ",document.head.appendChild(n),o.appendChild(e)}else setTimeout((()=>{o.parentNode&&(o.style.opacity="0",o.style.transform="translateX(-50%) translateY(20px)",setTimeout((()=>o.remove()),300))}),3e3)},waitForElement:(e,n=1e4)=>new Promise((t=>{const o=document.querySelector(e);if(o)return void t(o);const a=new MutationObserver((()=>{const n=document.querySelector(e);n&&(a.disconnect(),t(n))}));a.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{a.disconnect(),t(null)}),n)})),escapeHtml(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}};async function initializeIfEnabled(){try{if(!await NodeCopyManager.checkNodeSelectorEnabled())return;(("function"==typeof detectN8nPage?detectN8nPage():window.location.href.includes("n8n"))||window.location.href.includes("workflow"))&&NodeCopyManager.init()}catch(e){}}window.testNodeCopyManager=async function(){const e=document.getElementById("node-copy-button"),n=document.getElementById("node-copy-interface");let t=!1;return window.NodeCopyManager&&window.NodeCopyManager.checkApiKey&&(t=await window.NodeCopyManager.checkApiKey()),{apiClient:!!window.N8NApiClient,manager:!!window.NodeCopyManager,button:!!e,interface:!!n,hasApiKey:t}},window.debugNodeCopyManager=function(){document.querySelector('[data-test-id="canvas-handle-plus"]'),document.querySelector("g._plus_hyidj_129"),document.querySelector("g.source.clickable"),document.querySelector('[class*="plus"]');NodeCopyManager.init().then((e=>{}))},window.forceInitNodeCopyManager=function(){NodeCopyManager.createCopyButton(),NodeCopyManager.createCopyInterface()},window.testButtonCreation=function(){document.getElementById("node-copy-button")&&document.getElementById("node-copy-button").remove();const e=document.createElement("button");e.id="node-copy-button",e.innerHTML="‚ñº TEST",e.title="Test Copy Button",e.style.cssText="\n      position: fixed;\n      top: 100px;\n      right: 100px;\n      z-index: 9999;\n      padding: 8px 12px;\n      background: #007acc;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: bold;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    ",e.addEventListener("click",(()=>{alert("Test button clicked!")})),document.body.appendChild(e)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{setTimeout(initializeIfEnabled,1e3)})):setTimeout(initializeIfEnabled,1e3),window.NodeCopyManager=NodeCopyManager;